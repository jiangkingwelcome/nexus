# Nexus OS - 前端功能开发清单 (Client-Side Roadmap)

> 这份文档是专门为**前端开发**准备的功能清单。它以 **Todo List** 的形式整理，方便逐项打钩验收。

**项目代号:** Nexus Client  
**技术栈:** Vue 3 + TypeScript + Vite + Vant UI + Pinia  
**目标平台:** iOS (Safari PWA) / Android (Chrome PWA)

---

## 1. 基础设施层 (Infrastructure)

> **优先级：P0 (最高)** | 这一层决定了 App 能否运行。

### 1.1 项目初始化

- [ ] 完成 Vite + Vue3 + TS 脚手架搭建
- [ ] 配置 `Vant` UI 库 (按需引入)
- [ ] 配置 `UnoCSS` 或 `TailwindCSS` (可选，原子化 CSS)
- [ ] 配置 `Vue Router` (建议使用 Hash 模式 `createWebHashHistory` 以避免静态托管的路由问题)
- [ ] 配置 `Pinia` 状态管理

### 1.2 网络通信模块 (API Client)

- [ ] **文件接口:** 自建 API 对接各网盘（列表、获取直链等）
- [ ] **PocketBase 客户端:** 集成 JS SDK，实现用户登录保活、数据表 CRUD 操作
- [ ] **统一错误处理:** 全局拦截 401 (未登录) 和 Network Error，弹出 Toast 提示

### 1.3 本地存储与缓存 (Storage)

- [ ] **IndexedDB 封装:** 引入 `localforage`，用于存储大容量的文件目录树缓存
- [ ] **LocalStorage 封装:** 用于存储 Token、主题设置等轻量配置

---

## 2. 核心浏览模块 (Explorer)

> **优先级：P0** | 这一层决定了用户能否找到文件。

### 2.1 文件浏览器 (File Browser)

- [ ] **面包屑导航 (Breadcrumb):** 显示当前路径，点击父级可跳转
- [ ] **视图切换:** 支持"列表视图 (List)"和"网格视图 (Grid/Cover)"切换
- [ ] **文件图标:** 根据后缀名 (.md, .pdf, .html) 显示不同图标/封面
- [ ] **下拉刷新:** 刷新当前目录缓存

### 2.2 全局搜索 (Search)

- [ ] **索引构建:** App 启动时后台静默拉取完整目录树，存入 IndexedDB
- [ ] **即时搜索:** 顶部搜索框输入关键词，毫秒级返回匹配的文件（不查云端，只查本地索引）

---

## 3. 多态渲染引擎 (Universal Renderer)

> **优先级：P1** | 这一层是核心竞争力，决定了"万能"体验。

### 3.1 路由分发器 (Dispatcher)

- [ ] 实现一个动态组件 `<FileViewer :file="currentFile" />`，根据后缀名自动加载对应的子组件

### 3.2 Markdown 阅读器 (.md)

- [ ] 集成 `markdown-it` 解析核心
- [ ] **样式注入:** 实现类似 GitHub 或 Obsidian 的排版样式
- [ ] **双向链接解析:** 正则匹配 `[[文件名]]`，点击后自动通过 IndexedDB 查找路径并跳转
- [ ] **代码高亮:** 集成 `prismjs` 或 `highlight.js`

### 3.3 AI 应用容器 (.html)

- [ ] **沙箱隔离:** 使用全屏 `<iframe>` 加载文件直链
- [ ] **通信桥接:** 实现 `window.addEventListener('message')`，允许 HTML 内部向 App 发送"保存数据"请求
- [ ] **加载状态:** Iframe 加载过程中显示 Loading 骨架屏

### 3.4 流媒体播放器 (.mp4/.mp3)

- [ ] 集成 `plyr` 或使用原生 `<video>`
- [ ] **进度记忆:** 播放时每 5 秒向 PocketBase/LocalStorage 汇报一次进度；打开时自动跳转到上次位置
- [ ] **后台播放:** 配置 PWA Media Session API (支持锁屏控制)

### 3.5 文档阅读器 (.pdf/.epub)

- [ ] **PDF:** 集成 `pdfjs-dist` 或 `vue-pdf-embed`。支持手势缩放、页码跳转
- [ ] **EPUB (可选):** 集成 `epubjs`，支持字体大小调整、背景色切换

---

## 4. 知识互联与数据同步 (Knowledge & Sync)

> **优先级：P2** | 这一层让 App 变聪明。

### 4.1 双向同步机制

- [ ] **上报:** 阅读/观看结束时，将 `{ file_path, progress, timestamp }` 写入 PocketBase
- [ ] **拉取:** 打开文件前，先查询 PocketBase 是否有更新的进度
- [ ] **实时监听:** 使用 `pb.collection('progress').subscribe` 实现多端实时同步

### 4.2 笔记系统 (侧边栏/浮层)

- [ ] 在阅读器界面增加"写笔记"按钮
- [ ] 笔记内容自动关联当前 `file_path`，存入 PocketBase `notes` 表

---

## 5. PWA 原生化体验 (Native Experience)

> **优先级：P1** | 这一层解决 iOS/Android 兼容性。

### 5.1 Manifest 配置 (`vite-plugin-pwa`)

- [ ] 配置 App 名称、短名称、Theme Color
- [ ] 生成全套图标 (192x192, 512x512, Maskable)
- [ ] 设置 `display: standalone` 隐藏浏览器 UI

### 5.2 iOS 特性适配

- [ ] **安全区适配:** CSS 增加 `padding-bottom: env(safe-area-inset-bottom)` 适配全面屏手势条
- [ ] **禁止回弹:** 阻止 iOS Safari 的橡皮筋滚动效果 (Overscroll)
- [ ] **唤醒锁:** 阅读视频/PDF 时调用 `navigator.wakeLock` 防止息屏

### 5.3 离线能力 (Service Worker)

- [ ] 缓存 App 自身的 HTML/JS/CSS (App Shell 模型)
- [ ] (可选) 允许用户手动标记文件为"离线可用"，将其二进制数据存入 Cache Storage

---

## 6. 设置与管理 (Settings)

> **优先级：P3**

- [ ] **API 配置页:** 允许用户配置 PocketBase 地址和 Token (用于首次初始化)
- [ ] **缓存管理:** 显示当前 IndexedDB 占用空间，提供"清除缓存"按钮
- [ ] **主题切换:** 支持 浅色/深色/跟随系统 模式

---

## 开发建议路线图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            开发里程碑路线图                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌───────────┐ │
│  │  里程碑 1     │───▶│  里程碑 2     │───▶│  里程碑 3     │───▶│ 里程碑 4   │ │
│  │    MVP       │    │  AI Ready    │    │    Sync      │    │  Polish   │ │
│  └──────────────┘    └──────────────┘    └──────────────┘    └───────────┘ │
│         │                   │                   │                  │       │
│         ▼                   ▼                   ▼                  ▼       │
│  • 文件接口          • HTML 容器         • PocketBase      • PWA 图标      │
│  • 文件列表          • Markdown 双链      • 进度同步         • Splash       │
│  • PDF/视频打开      • 代码高亮           • 实时监听         • UI 打磨      │
│                                                                             │
│  ────────────────────────────────────────────────────────────────────────── │
│  目标: 能用就行       目标: AI 工具可跑    目标: 多端同步      目标: 发布就绪  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 里程碑 1: MVP (最小可行产品)

**目标:** 能用就行

| 功能 | 状态 |
|------|------|
| 文件接口 | ⬜ |
| 文件列表展示 | ⬜ |
| 简单 PDF 打开 | ⬜ |
| 视频播放 | ⬜ |

### 里程碑 2: AI Ready

**目标:** AI 小工具可以跑

| 功能 | 状态 |
|------|------|
| HTML 沙箱容器 | ⬜ |
| Markdown 渲染 | ⬜ |
| 双向链接解析 | ⬜ |
| 代码高亮 | ⬜ |

### 里程碑 3: Sync

**目标:** 实现多端同步

| 功能 | 状态 |
|------|------|
| PocketBase 接入 | ⬜ |
| 进度同步 | ⬜ |
| 实时监听 | ⬜ |
| 笔记系统 | ⬜ |

### 里程碑 4: Polish

**目标:** 发布就绪

| 功能 | 状态 |
|------|------|
| PWA 图标 | ⬜ |
| Splash Screen | ⬜ |
| 主题切换 | ⬜ |
| UI 细节打磨 | ⬜ |

---

## 功能完成度统计

| 模块 | 总计 | 已完成 | 进度 |
|------|------|--------|------|
| 基础设施层 | 10 | 0 | 0% |
| 核心浏览模块 | 6 | 0 | 0% |
| 多态渲染引擎 | 13 | 0 | 0% |
| 知识互联与同步 | 5 | 0 | 0% |
| PWA 原生化 | 7 | 0 | 0% |
| 设置与管理 | 3 | 0 | 0% |
| **总计** | **44** | **0** | **0%** |

---

## 验收标准

每个功能项完成后，需满足以下条件方可打钩：

1. ✅ 功能按预期工作
2. ✅ 无控制台报错
3. ✅ iOS Safari 和 Android Chrome 均测试通过
4. ✅ 代码已提交并通过 Review
